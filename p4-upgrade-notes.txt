cannot downgrade, so check point is essential

the process is simple, documented here:
http://kb.perforce.com/article/46/upgrading-a-perforce-server

backup procedure:

on negheb:

# recompute MD5s of all archived files; compare to stored version.  No news is good news.
p4 verify -q //...

negheb-> p4 verify -q //... 
negheb-> 

negheb-> p4 admin checkpoint
negheb-> echo $?
0

    4.  Once the checkpoint has been created successfully, back up the checkpoint file,
    the old journal file, and your versioned files. (In most cases, you don't actually
    need to back up the journal, but it is usually good practice to do so.)

negheb-> tar -czf ~/p4d-backup.tgz checkpoint.41* journal* license jwm-depot/
negheb-> ls -lsh /home/jwm/p4d-backup.tgz 
287M -rw-r--r-- 1 jwm jwm 286M 2011-03-14 16:46 /home/jwm/p4d-backup.tgz

Okay, now set up a new server instance on alpha.

modify my RHEL init script: rhel-init-cernocp for p4d.

In the meantime, set up a server on alpha.  The current release.
See if the upgrade 'works'.
Test with verify.

I put the server in /usr/sbin/p4d
client is /usr/bin/p4

DONE write the init script; store on thumb drive

decide on backup strategy:
  weekly check points and backup to a tar tree that gets rotated

I could not use the 1,000 file p4 daemon as the limit is on total files,
and I have ~2,500.

----------------

create the db files:




So I needed to get a new license file for IP address: 
proteus-> host p4.mccarrell.org
p4.mccarrell.org has address 174.127.115.193

----------------

start the server before the init script is in place:

export P4PORT=2333
export P4ROOT=~p4user/p4root
p4d -L $P4ROOT/p4errs -d

I have to go get an older version server compiled for linux 2.6 64 bit.
That may just not exist!

ftp://ftp.perforce.com/perforce/r06.1/bin.linux26x86_64/
has it

since my support ended 2007/09/15, try the latest 2007 server, 2007.3
2007.2 fails


2006.1 succeeds

then load the meta data and try again:

go back, re-extract the data from negheb, move it over, and try again:

root@negheb:~# su - p4
No directory, logging in with HOME=/
$ cd /home/perforce
$ /home/perforce/p4d -r /home/perforce -J /home/perforce/journal -jc
Checkpointing to checkpoint.412...
Saving journal to journal.411...
Truncating /home/perforce/journal...

----

restore from the journal and checkpoint
  from backup and recovery of p4sag: 
  http://www.perforce.com/perforce/doc.current/manuals/p4sag/02_backup.html

[p4user@alpha p4root]$ p4d -r ~/p4root -jr checkpoint.412 journal
Recovering from checkpoint.412...
Recovering from journal...
[p4user@alpha p4root]$ p4d -r ~/p4root -L ~/p4root/p4errs 
Perforce Server starting...


----

proteus-> p4 info
User name: jwm
Client name: jwm-notes-proteus
Client host: usca1mc-3m5agz
Client unknown.
Current directory: /j/notes
Client address: 72.247.151.10:9652
Server address: alpha:2333
Server root: /home/p4user/p4root
Server date: 2011/03/16 17:06:32 -0700 PDT
Server version: P4D/LINUX26X86_64/2006.1/114363 (2007/01/10)
Server license: Employment Technology Consultants 1 users (support expired 2007/09/15) 

verify the result:

proteus-> p4 verify -q //... ; echo $?
0

----

Finish up:
  DONE install the init script
  DONE shut down p4 on negheb to prevent mistakes
  version the new license file in the p4 depot
  version my p4d init script in the p4 depot
  IN PROGRESS point clients to alpha
    proteus:
      p4v
      proteus-> p4 clients | grep -i proteus
      DONE Client jwm-notes-MAIN-proteus 2010/02/21 root /j/notes-MAIN Mainline for Jeffs notes
      DONE Client jwm-notes-proteus 2010/02/22 root /j/notes 'Jeffs notes on proteus '
      DONE Client jwm-proj-books-proteus 2010/05/15 root /j/proj/books
      DONE Client jwm-proj-pmsport-proteus 2010/04/04 root /j/proj/pmsport
      DONE Client jwm-stick1301-pdata-proteus 2011/02/05 root /Volumes/stick1301/j/personal
      DONE Client jwm-www-proteus 2010/02/21 root /j/www 'Jeffs www on proteus '
    DONE capella
      DONE p4v
      DONE capella-> p4 clients | grep capella 
      DONE Client jwm-home-capella 2011/01/21 root /Users/jwm/ 'Jeff's env and dot files. '
      DONE Client jwm-notes-capella 2011/01/24 root /j/notes 'Jeffs notes client on capella '
      DONE Client jwm-pdata-capella 2011/02/10 root /j/pdata 'Jeffs data on capella. '
      DONE Client jwm-software-capella 2011/03/06 root /j/sw 'My software tree on capella'
      DONE Client jwm-usell-gold-capella 2011/02/13 root /uww 'Jeffs Upstream . '
      DONE Client jwm-www-capella 2011/01/22 root /j/www 'Jeffs web site on capella. '

